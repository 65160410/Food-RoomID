<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Join Room - FoodMate</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      /* ตั้งค่าพื้นหลังและฟอนต์ */
      body {
        font-family: Arial, sans-serif;
        background-color: #ffebe0;
        color: #333;
        display: flex;
      }

      /* Container สำหรับจัดหน้าเว็บ */
      .container {
        display: flex;
        width: 100%;
      }

      /* Sidebar */
      .sidebar {
        width: 20%;
        background-color: #fff3e0;
        padding: 20px;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      }

      .sidebar ul {
        list-style: none;
        padding: 0;
      }

      .sidebar ul li {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        border: 2px solid white; /* เพิ่มกรอบสีขาว */
        padding: 5px; /* เพิ่มพื้นที่ในกรอบ */
        border-radius: 8px; /* ทำมุมกรอบให้โค้ง */
      }

      .sidebar ul li img {
        border-radius: 50%;
        width: 40px;
        height: 40px;
        margin-right: 10px;
      }

      /* Card กลาง */
      .card {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        text-align: center;
        width: 350px;
      }

      /* หัวข้อ */
      .card h2 {
        color: #ff7a55;
        margin-bottom: 5px;
      }

      /* คำอธิบาย */
      .card p {
        color: gray;
        font-size: 14px;
        margin-bottom: 15px;
      }

      /* รูปภาพ */
      .card img {
        width: 100%;
        border-radius: 8px;
        margin-bottom: 15px;
      }

      /* Input Group */
      .input-group {
        display: flex;
        align-items: center;
        background: #f0f0f0;
        padding: 10px;
        border-radius: 6px;
        margin-bottom: 15px;
      }

      .input-group i {
        color: gray;
        margin-right: 8px;
      }

      .input-group input {
        border: none;
        background: none;
        outline: none;
        width: 100%;
        font-size: 14px;
      }

      /* ปุ่ม Join */
      .join-btn {
        width: 100%;
        padding: 10px;
        background: #ff5722;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        transition: 0.3s;
      }

      .join-btn:hover {
        background: #ff7a55;
      }

      /* ข้อความลิงก์ด้านล่าง */
      .footer-text {
        font-size: 12px;
        color: gray;
        margin-top: 10px;
      }

      .footer-text a {
        color: #ff5722;
        text-decoration: none;
      }

      .footer-text a:hover {
        text-decoration: underline;
      }

      /* Main Content */
      .main-content {
        width: 80%;
        padding: 20px;
      }

      .food-card {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        padding: 20px;
        text-align: center;
        margin-bottom: 20px;
      }

      .food-card img {
        width: 40%;
        height: auto;
        display: block;
        margin: 0 auto;
      }

      .food-info {
        margin-top: 20px;
      }

      .food-info h3 {
        font-size: 24px;
        color: #e74c3c;
      }

      .food-info p {
        font-size: 16px;
        color: #777;
      }

      .buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 15px;
      }

      .buttons button {
        border: none;
        border-radius: 20px;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 16px;
        transition: 0.3s;
      }

      .buttons .dislike {
        background-color: #ff6b6b;
        color: #fff;
      }

      .buttons .neutral {
        background-color: #f1c40f;
        color: #fff;
      }

      .buttons .like {
        background-color: #2ecc71;
        color: #fff;
      }

      .buttons button:hover {
        opacity: 0.8;
      }

      .action-buttons {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
      }

      .action-buttons button {
        border: none;
        padding: 10px 20px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 18px;
        transition: 0.3s;
      }

      .action-buttons .view-results {
        background-color: #e67e22;
        color: #fff;
      }

      .action-buttons .vote-restaurant {
        background-color: #e74c3c;
        color: #fff;
      }

      .action-buttons button:hover {
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="sidebar">
        <h2 id="roomTitle">Food Group</h2>
        <h3 id="memberCount">Members (0)</h3>
        <ul id="memberList">
          <!-- รายชื่อสมาชิกจะถูกแทรกที่นี่ -->
        </ul>
      </div>
      <div class="main-content">
        <div class="food-card">
          <div class="food-header">
            <h2>Current Selection <span class="counter"></span></h2>
          </div>
          <img
            src="https://cdn.discordapp.com/attachments/1340746744165564477/1340762871658713160/image.png"
            alt="Food"
          />
          <div class="food-info">
            <h3 id="foodName">ข้าวกะเพรา</h3>
            <p id="foodDescription">ข้าวกะเพราหมูสับ</p>
            <div class="buttons">
              <button class="dislike">
                <i class="fas fa-times"></i> Dislike
              </button>
              <button class="neutral">
                <i class="fas fa-meh"></i> Neutral
              </button>
              <button class="like"><i class="fas fa-check"></i> Like</button>
            </div>
          </div>
        </div>
        <div class="action-buttons">
          <button class="view-results">
            <i class="fas fa-chart-bar"></i> View AI Results
          </button>
          <button class="vote-restaurant">
            <i class="fas fa-utensils"></i> Vote for Restaurant
          </button>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // ดึง query parameters จาก URL
        const params = new URLSearchParams(window.location.search);
        const userID = params.get("userID");
        const room_name = params.get("room_name");

        console.log("UserID:", userID);
        console.log("Room Code:", room_name);

        // อัปเดตหัวข้อห้อง
        document.getElementById("roomTitle").textContent =
          "Food Group #" + room_name;

        // ดึงรายชื่อสมาชิกจาก API
        fetch(
          `${API_BASE_URL}/roomMembers.php?room_name=` +
            encodeURIComponent(room_name)
        )
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "success") {
              const members = data.members;
              const memberList = document.getElementById("memberList");
              memberList.innerHTML = ""; // ล้างรายการเก่าออก

              members.forEach((member) => {
                // สร้าง li สำหรับสมาชิกแต่ละคน
                const li = document.createElement("li");
                const profileImage = member.profileImage
                  ? member.profileImage
                  : "../image/cat.png";
                const hostLabel = member.isHost == 1 ? " (Host)" : "";
                li.innerHTML = `<img src="${profileImage}" alt="${member.Username}">
                                    <span>${member.Username}${hostLabel}</span>`;
                memberList.appendChild(li);
              });

              document.getElementById("memberCount").textContent =
                "Members (" + members.length + ")";
            } else {
              console.error("Error fetching room members:", data.message);
            }
          })
          .catch((error) => console.error("Error:", error));

        // --- เพิ่ม Event Listeners ให้กับปุ่มต่าง ๆ ---

        // ฟังก์ชันส่งคะแนนโหวตสำหรับอาหาร
        const voteFood = (voteType) => {
          // ดึงข้อมูลของอาหารจากหน้า
          const foodName = document.getElementById("foodName").textContent;
          const foodDescription =
            document.getElementById("foodDescription").textContent;

          // ส่งคะแนนไปยัง API (vote.php)
          fetch(`${API_BASE_URL}/vote.php`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              userID: userID,
              room_name: room_name,
              foodName: foodName,
              vote: voteType,
            }),
          })
            .then((response) => response.json())
            .then((result) => {
              // ตรวจสอบให้แน่ใจว่า API ส่งกลับ key 'message'
              alert(result.message);
            })
            .catch((error) =>
              console.error("Error sending vote for food:", error)
            );
        };

        document
          .querySelector(".dislike")
          .addEventListener("click", function () {
            voteFood("dislike");
          });
        document
          .querySelector(".neutral")
          .addEventListener("click", function () {
            voteFood("neutral");
          });
        document.querySelector(".like").addEventListener("click", function () {
          voteFood("like");
        });

        // สำหรับการดูผล AI (View AI Results)
        document
          .querySelector(".view-results")
          .addEventListener("click", function () {
            window.location.href =
              "aiResults.html?room_name=" +
              encodeURIComponent(room_name) +
              "&userID=" +
              encodeURIComponent(userID);
          });

        // สำหรับการโหวตร้านอาหาร (Vote for Restaurant)
        document
          .querySelector(".vote-restaurant")
          .addEventListener("click", function () {
            window.location.href =
              "voteRestaurant.html?room_name=" +
              encodeURIComponent(room_name) +
              "&userID=" +
              encodeURIComponent(userID);
          });
      });
    </script>

    <!-- API_BASE_URL ควรถูกประกาศไว้ในไฟล์ api.js หรือในสคริปต์นี้ -->
    <script src="../api/api.js"></script>
  </body>
</html>
