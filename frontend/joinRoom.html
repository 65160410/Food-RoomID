<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Join Room - FoodMate</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      /* ตั้งค่าพื้นหลังและฟอนต์ */
      body {
        font-family: Arial, sans-serif;
        background-color: #ffebe0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
      }
      /* Container สำหรับจัดหน้าเว็บ */
      .container {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      /* Card กลาง */
      .card {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        text-align: center;
        width: 350px;
      }
      /* หัวข้อ */
      .card h2 {
        color: #ff7a55;
        margin-bottom: 5px;
      }
      /* คำอธิบาย */
      .card p {
        color: gray;
        font-size: 14px;
        margin-bottom: 15px;
      }
      /* รูปภาพ */
      .card img {
        width: 100%;
        border-radius: 8px;
        margin-bottom: 15px;
      }
      /* Input Group */
      .input-group {
        display: flex;
        align-items: center;
        background: #f0f0f0;
        padding: 10px;
        border-radius: 6px;
        margin-bottom: 15px;
      }
      .input-group i {
        color: gray;
        margin-right: 8px;
      }
      .input-group input {
        border: none;
        background: none;
        outline: none;
        width: 100%;
        font-size: 14px;
      }
      /* ปุ่ม Join */
      .join-btn {
        width: 100%;
        padding: 10px;
        background: #ff5722;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        transition: 0.3s;
      }
      .join-btn:hover {
        background: #ff7a55;
      }
      /* ข้อความลิงก์ด้านล่าง */
      .footer-text {
        font-size: 12px;
        color: gray;
        margin-top: 10px;
      }
      .footer-text a {
        color: #ff5722;
        text-decoration: none;
      }
      .footer-text a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h2>Join Room</h2>
        <p>Enter the room code to join your friends</p>
        <img
          src="https://cdn.discordapp.com/attachments/1318835776661880883/1340755162326761552/image.png"
          alt="Join Room Image"
        />
        <div class="input-group">
          <i class="fas fa-hashtag"></i>
          <input type="text" id="room_name" placeholder="Enter Room Code" />
        </div>
        <button id="joinRoomBtn" class="join-btn">
          <i class="fas fa-door-open"></i> Join Room
        </button>

        <p class="footer-text">
          Don't have a room code? <a href="#">Create a new room</a>
        </p>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // สมมติว่าปุ่ม Join มี id "joinRoomBtn"
        const joinButton = document.getElementById("joinRoomBtn");
        if (joinButton) {
          joinButton.addEventListener("click", joinRoom);
        } else {
          console.error("Join button not found");
        }

        function joinRoom() {
          const room_nameInput = document.getElementById("room_name");
          if (!room_nameInput) {
            alert("Room code input not found.");
            return;
          }

          const room_name = room_nameInput.value.trim();
          if (!room_name) {
            alert("Please enter a valid room code.");
            return;
          }

          // ดึง userID ของผู้เข้าร่วมจาก localStorage
          const joinerId = localStorage.getItem("userID");
          if (!joinerId) {
            alert("User not found. Please login again.");
            window.location.href = "login.html";
            return;
          }

          // เรียก API joinRoom.php เพื่อเข้าร่วมห้อง
          fetch(`${API_BASE_URL}/joinRoom.php`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              room_name: room_name,
              joinerId: joinerId,
            }),
          })
            .then((response) => response.json())
            .then((result) => {
              console.log(result);
              if (result.status === "success") {
                alert("Joined room successfully!");
                // เมื่อเข้าร่วมห้องสำเร็จ redirect ไปที่ roomMembers.html.html พร้อมส่ง query parameter เช่น userID และ room_name
                window.location.href =
                  "roomMembers.html?userID=" +
                  encodeURIComponent(joinerId) +
                  "&room_name=" +
                  encodeURIComponent(room_name);
              } else {
                alert(result.message || "Failed to join room.");
              }
            })
            .catch((error) => {
              console.error("Error joining room: ", error);
              alert("An error occurred while joining the room.");
            });
        }
      });
    </script>

    <!-- API_BASE_URL ควรถูกประกาศไว้ในไฟล์ api.js หรือในสคริปต์นี้ -->
    <script src="../api/api.js"></script>
  </body>
</html>
